<section class="search-result-content">

	<div id='search_map'></div>

		<script>
		var map = L.mapbox.map('search_map', 'afbresley.i42ckik9').setView(["39.12367", "-76.81229"], 2);

		var myLayer = L.mapbox.featureLayer().addTo(map);

		// The GeoJSON representing the two point features
		var geoJson = {
		    'type': 'FeatureCollection',
		    'features': [
		    <% @restaurants.each do |restaurant| %>
		        {'type': 'Feature',
					'geometry': {
							'type': 'Point',
							'coordinates': [<%= restaurant.longitude %>, <%= restaurant.latitude %>]
						},
						'properties': {
							'title': "<%= restaurant.name %>",
							'marker-color': '#c41200',
							'marker-symbol': 'marker',
							'marker-size': 'medium'
						}
		    },
	    <% end %>
	    	{'type': 'Feature',
					'geometry': {
							'type': 'Point',
							'coordinates': [-110,40]
						},
						'properties': {
							'title': "dummy",
							'marker-color': '#c41200',
							'marker-symbol': 'marker',
							'marker-size': 'medium'
						}
		    }]
		};

		// Pass features and a custom factory function to the map
		myLayer.setGeoJSON(geoJson);
		myLayer.on('mouseover', function(e) {
		    e.layer.openPopup();
		});
		myLayer.on('mouseout', function(e) {
		    e.layer.closePopup();
		});
    myLayer.on('click', function(e) {
      map.panTo(e.layer.getLatLng());
    });

	</script>
	</div>

<section class="search-restaurant-list">
	<%#= paginate @restaurants %>
	<ul>
		<% @restaurants.each do |restaurant| %>
			<li>
				<a href="<%= restaurant_url(restaurant) %>">	
					<%= restaurant.name %> 
					<% restaurant.average_rating.each do |star| %>
						<i class="<%= star %>"></i>  
					<% end %>
				</a>
			</li>
		<% end %>
	</ul>
</section>

		<% content_for :sidebar do %>

			<section class="search-sidebar">
			<h3>
				<ul>
					<label>You searched for:</label>
						<li><%= @search.search_params %></li>
					<label>Near:</label>
						<li><%= @search.start_location %></li>
				</ul>
			</h3>


				Parameters: 
				<form >
					<label>New Category?</label>
						<input type="text" name="search[search_params]" value="">

					<label>New Location?</label>
		        <input type="text" name="search[start_location]" value="">

					<label>Select Stars</label>
						<input type="range" min="0" max="5" value="1" />

	        <input type="hidden" name="search[user_id]" value="<%= current_user ? current_user.id : nil %>">

	        <input type="hidden" name="search[current_lat]" value="">
	        <input type="hidden" name="search[current_long]" value="">

	        <input type="submit" value="Refine Search"> 
				</form>


			</section>
		<% end %>

</section>

